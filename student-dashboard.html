<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Dashboard - School of Mines e-Granthalaya</title>
    <link rel="stylesheet" href="css/styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
</head>

<body>
    <div class="dashboard-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <img src="assets/logo.png" alt="Logo" class="sidebar-logo">
                <h2>e-Granthalaya</h2>
                <p class="user-type" id="studentName">Student</p>
            </div>

            <nav class="sidebar-nav">
                <a href="#" class="nav-item active" data-tab="books">
                    <span class="nav-icon">üìö</span>
                    <span>All Books</span>
                </a>
                <a href="#" class="nav-item" data-tab="borrowed">
                    <span class="nav-icon">üìñ</span>
                    <span>My Borrowed Books</span>
                </a>
                <a href="#" class="nav-item" data-tab="history">
                    <span class="nav-icon">üìã</span>
                    <span>My History</span>
                </a>
                <a href="#" class="nav-item" data-tab="profile">
                    <span class="nav-icon">üë§</span>
                    <span>My Profile</span>
                </a>
            </nav>

            <div class="sidebar-footer">
                <button class="btn btn-logout" onclick="logout()">
                    <span>üö™</span> Logout
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="dashboard-header">
                <div class="header-left">
                    <h1>School of Mines e-Granthalaya</h1>
                    <p id="currentDate"></p>
                </div>
                <div class="header-right">
                    <span class="student-badge" id="studentIdBadge">üë®‚Äçüéì Student</span>
                </div>
            </header>

            <!-- Books Tab -->
            <section id="booksTab" class="tab-content active">
                <div class="section-header">
                    <h2>üìö Available Books</h2>
                    <div class="filters-row">
                        <select id="departmentFilter" onchange="filterByDepartment()">
                            <option value="">All Departments</option>
                            <option value="computer-science">üíª Computer Science E-Books</option>
                            <option value="mechanical">‚öôÔ∏è Mechanical E-Books</option>
                            <option value="mining">‚õèÔ∏è Mining E-Books</option>
                        </select>
                        <div class="search-bar">
                            <input type="text" id="bookSearch" placeholder="Search books..." onkeyup="filterBooks()">
                        </div>
                    </div>
                </div>
                <div class="info-banner">
                    <span>üìÖ Borrowing Period: <strong>15 Days</strong> | Books must be returned within 15 days</span>
                </div>
                <div id="booksGrid" class="books-grid">
                    <!-- Books will be loaded here -->
                </div>
            </section>

            <!-- My Borrowed Books Tab -->
            <section id="borrowedTab" class="tab-content">
                <div class="section-header">
                    <h2>üìñ My Borrowed Books</h2>
                    <div class="stats-mini">
                        <span id="currentlyBorrowed">0 Books Currently Borrowed</span>
                    </div>
                </div>
                <div class="info-banner">
                    <span>üìö Click "Read Book" to view and read your borrowed books</span>
                </div>
                <div id="borrowedBooksGrid" class="books-grid">
                    <!-- Borrowed books will be loaded here -->
                </div>
            </section>

            <!-- History Tab -->
            <section id="historyTab" class="tab-content">
                <div class="section-header">
                    <h2>üìã My Borrowing History</h2>
                    <div class="stats-mini">
                        <span id="myBorrowings">0 Books Borrowed</span>
                    </div>
                </div>
                <div class="history-container">
                    <div id="historyTimeline" class="history-timeline">
                        <!-- History will be loaded here -->
                    </div>
                </div>
            </section>

            <!-- Profile Tab -->
            <section id="profileTab" class="tab-content">
                <div class="section-header">
                    <h2>üë§ My Profile</h2>
                </div>
                <div class="profile-card">
                    <div class="profile-avatar">üë®‚Äçüéì</div>
                    <div class="profile-info">
                        <h3 id="profileName">-</h3>
                        <p id="profileEmail">-</p>
                        <p id="profileDepartment">-</p>
                        <p id="profileId">Student ID: -</p>
                    </div>
                    <div class="profile-stats">
                        <div class="stat-item">
                            <span class="stat-value" id="profileTotalBorrowed">0</span>
                            <span class="stat-label">Total Borrowed</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-value" id="profileCurrentlyHolding">0</span>
                            <span class="stat-label">Currently Holding</span>
                        </div>
                        <div class="stat-item" id="overdueSection" style="display: none;">
                            <span class="stat-value overdue-text" id="profileOverdue">0</span>
                            <span class="stat-label">Overdue</span>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Borrow Modal -->
    <div id="borrowModal" class="modal">
        <div class="modal-content">
            <span class="modal-close" onclick="closeModal()">&times;</span>
            <h2>üìö Borrow Book</h2>
            <div id="modalBookDetails">
                <!-- Book details will be shown here -->
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="closeModal()">Cancel</button>
                <button class="btn btn-primary" id="confirmBorrowBtn">Confirm Borrow</button>
            </div>
        </div>
    </div>

    <!-- Return Modal -->
    <div id="returnModal" class="modal">
        <div class="modal-content">
            <span class="modal-close" onclick="closeReturnModal()">&times;</span>
            <h2>üìñ Return Book</h2>
            <div id="returnModalDetails">
                <!-- Book details will be shown here -->
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="closeReturnModal()">Cancel</button>
                <button class="btn btn-success" id="confirmReturnBtn">Confirm Return</button>
            </div>
        </div>
    </div>

    <!-- Book Reader Modal -->
    <div id="bookReaderModal" class="modal book-reader-modal">
        <div class="modal-overlay" onclick="closeBookReader()"></div>
        <div class="modal-content reader-content">
            <div class="reader-header">
                <div class="reader-book-info">
                    <h3 id="readerBookTitle">Book Title</h3>
                    <p id="readerBookAuthor">Author Name</p>
                </div>
                <button class="modal-close" onclick="closeBookReader()">‚úï</button>
            </div>
            <div class="reader-body" id="readerBody">
                <!-- Book content will be displayed here -->
                <div class="reader-placeholder">
                    <div class="book-preview-icon">üìñ</div>
                    <p>Loading book content...</p>
                </div>
            </div>
            <div class="reader-footer">
                <div class="reader-info">
                    <span id="readerDueDate"></span>
                </div>
                <div class="reader-actions">
                    <button class="btn btn-secondary" onclick="closeBookReader()">Close</button>
                </div>
            </div>
        </div>
    </div>

    <script src="js/database.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/books.js"></script>
    <script src="js/app.js"></script>
    <script>
        // Check if student is logged in
        if (!isStudentLoggedIn()) {
            window.location.href = 'student-login.html';
        }

        // Initialize dashboard
        initStudentDashboard();

        // Tab switching
        document.querySelectorAll('.nav-item').forEach(item => {
            item.addEventListener('click', function (e) {
                e.preventDefault();
                const tab = this.dataset.tab;

                // Update active nav item
                document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
                this.classList.add('active');

                // Update active tab content
                document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
                document.getElementById(tab + 'Tab').classList.add('active');

                // Reload data when switching to specific tabs
                if (tab === 'borrowed') {
                    loadBorrowedBooks();
                } else if (tab === 'history') {
                    loadStudentHistoryTimeline();
                } else if (tab === 'profile') {
                    loadStudentProfile();
                } else if (tab === 'books') {
                    loadBooksGrid(false);
                }
            });
        });

        // Set current date
        document.getElementById('currentDate').textContent = new Date().toLocaleDateString('en-IN', {
            weekday: 'long',
            year: 'numeric',
            month: 'long',
            day: 'numeric'
        });
    </script>
</body>

</html>